#!/usr/bin/env bash
set -e

echo "ğŸš€ Iniciando despliegue de Paladino Propiedades..."

echo "ğŸ“¥ Actualizando cÃ³digo desde el repositorio..."
git pull

echo "ğŸ“¦ Instalando dependencias de producciÃ³n..."
npm ci --omit=dev

echo "ğŸ”¨ Construyendo la aplicaciÃ³n..."
npm run build

echo "ğŸ”„ Recargando aplicaciÃ³n con PM2..."
if command -v pm2 &> /dev/null; then
    pm2 reload paladino
    echo "âœ… AplicaciÃ³n recargada con PM2"
else
    echo "âš ï¸  PM2 no estÃ¡ instalado. Instalando PM2 globalmente..."
    npm install -g pm2
    echo "ğŸ”„ Iniciando aplicaciÃ³n con PM2..."
    pm2 start npm --name "paladino" -- start
    echo "âœ… AplicaciÃ³n iniciada con PM2"
fi

echo "âœ… Despliegue completado exitosamente!"
echo "ğŸŒ La aplicaciÃ³n estÃ¡ disponible en: http://localhost:3000"
